<!DOCTYPE html>
<html lang="en">
<head>
	<% include ../partials/head %>
	<title>M-Car Share My Current Car</title>
</head>
<body>

<div class="container-fluid" id="container">
	<div class="row">
		<div class="col-md-12" id="main">
			<% include ../partials/header %>
			<ul class="breadcrumb" id="breadcrumb">
				<li>
					<a href="/index" class="active">Home</a>
				</li>
				<li class="active">My Car</li>
			</ul>
			<% for(var i in bills) {%>
			<div class="row" id="contentPanel<%= bills[i]._id %>">
				<div class="col-md-3"></div>
				<div class="col-md-6">
					<div class="panel panel-default">
						<div class="panel-body">

							<div class="row">
								<div class="col-md-6">
									<img alt="Economy Car" src="../images/cars/economy.png" class="carModelImg" />
								</div>
								<div class="col-md-6">

									<button type="button" class="btn btn-success" onclick="dropOffCar(<%= bills[i]._id %>, <%= bills[i].car._id %>);">
										I dropped off the car
									</button>
									<button id="reportDamageBTN" type="button" class="btn btn-warning" onclick="myFunction()">
										I want ro report damages
									</button>
								</div>
							</div>
							<dl>
								<dt>
									You rented <%= bills[i].car.carModel %> <%= bills[i].car.carName %>
								</dt>
								<dd>
									MANUAL
								</dd>
								<dt>
									Per Kilometers
								</dt>
								<dd>
									CAD <%= bills[i].car.price %>
								</dd>
							</dl>
						</div>
					</div>
				</div>
				<div class="col-md-3"></div>

			</div>
			<%}%>
		</div>

	</div>
</div>
<!-- Bill Dialog start-->
<% include finalInvoice.ejs %>
<!-- Bill Dialog end -->
<script src="../js/jquery.min.js"></script>
<script src="../js/bootstrap.min.js"></script>
<script src="../js/scripts.js"></script>
<script>
	var firstName = "<%= user.firstName %>" + " " + "<%= user.lastName %>"
	function dropOffCar(billId, carId) {

		var data = {
			billId: billId,
			carId: carId,
			location: TrackCar(-180, 180, 3),
			distanceTravelled: getDistance(1, 1000)
		};

		$.ajax({
			type: 'post',
			url: '/pages/dropOffCar',
			data: data,
			success: function (result) {
				if (result == "ERROR") {
					alert("A problem occured. Try again later.");
				} else {

					$("#contentPanel"+billId).remove();

					$('#username').val(firstName );
					$('#carname').val(result.data.car.carName);
					$('#pickupDate').val(result.data.pickUpDate);
					$('#pickUpTime').val(result.data.pickUpTime);
					$('#dropOffDate').val(result.data.dropOffDate);
					$('#dropOffTime').val(result.data.dropOffTime);
					var amount = Number(result.data.amount) - Number(result.data.discount);
					$('#amount').val(result.data.amount);
					$('#discount').val(result.data.discount);
					$('#totalAmount').val(amount);
					$('#distance').val(result.data.distanceTravelled);
					if (result.data.damage) {
						$('#damage').val(result.data.damage.description);
					} else {
						$('#damage').val('None');
					}


					$('#modal-container-finalInvoice').modal('show');
				}
			},
			error: function () {
				alert("A problem occured. Try again later.");
			}
		});
	}

	// generate random location
	function TrackCar(from, to, fixed) {
		var location = { latitude: (Math.random() * (to - from) + from).toFixed(fixed) * 1,
			longitude: (Math.random() * (to - from) + from).toFixed(fixed) * 1
		}
		return location;
	}

	// generate random distance
	function getDistance(minimum, maximum) {
		return Math.floor(Math.random() * (maximum - minimum + 1)) + minimum;
	}

</script>
</body>